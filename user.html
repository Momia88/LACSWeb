<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>LACS Tables</title>

		<link href="css/bootstrap.css" rel="stylesheet">
		<link href="css/bootstrap-table.css" rel="stylesheet">
		<link href="css/styles.css" rel="stylesheet">
		<link href="css/loading.css" rel="stylesheet">

		<script src="js/jquery-3.1.1.min.js"></script>
		<script src="js/bootstrap-table.js"></script>
		<script src="js/Variables.js"></script>

		<!--Icons-->
		<script src="js/lumino.glyphs.js"></script>
	</head>

	<body>
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<a class="navbar-brand" href="#">LACS DashBoard</a>
			<ul class="user-menu">
				<li class="dropdown pull-right">
					<a href="index.html">Logout</a>
				</li>
			</ul>
		</nav>

		<div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar"></div>
		<script>
			$(function() {
				$("#sidebar-collapse").load("Menu.html");
			});
		</script>
		<!--/.sidebar-->

		<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">
			<div class="row" style="font-size: 24px; margin: 5px 10px 5px 0px">
				使用者管理
			</div>
			<div class="row">
				<div class="col-md-6">
					<div class="panel panel-default">
						<div class="panel-heading">
							使用者列表
						</div>
						<div class="panel-body" style="float: right">
							<button onclick="addUser('123','123','123');" >
								新增使用者
							</button>
						</div>
						<div class="panel-body">
							<table id="tb_report"></table>
						</div>
					</div>
				</div>
			</div>

			<script type="text/javascript"></script>
			<!--/.row-->
		</div>
		<!--/.main-->

		<script>
			window.operateEvents = {
				'click .remove' : function(e, value, row) {
					var r = confirm("確定要刪除使用者: " + row.userName);
					if (r == true) {
						tableRefresh();
						alert("You pressed OK!");
					}
				},
				// 'click .edit' : function(e, value, row) {
				// alert('You click edit action, row: ' + JSON.stringify(row));
				// },
			};

			function operateFormatter(value, row, index) {
				//return ['<div class="pull-right">', '<a class="edit" href="javascript:void(0)" title="Edit">', '<i class="glyphicon glyphicon-edit"></i>', '</a>  ', '<a class="remove" href="javascript:void(0)" title="Remove">', '<i class="glyphicon glyphicon-remove"></i>', '</a>', '</div>'].join('');
				return ['<a class="remove" href="javascript:void(0)" title="Remove">', '<i class="glyphicon glyphicon-remove"></i>', '</a>', '</div>'].join('');

			};

			jsonData = $.ajax({
				url : serverIP + '/service/userlist',
				type : "GET",
				dataType : 'json',
				success : function(jsonData) {
					// Split timestamp and data into
					// separate arrays
					if (jsonData == null) {
						alert("沒有資料喔！請確認一下查詢時間，或連絡系統管理員。");
						return;
					}

					$('#tb_report').bootstrapTable({
						showExport : true, //是否顯示導出
						exportDataType : "basic", //basic', 'all', 'selected'.
						columns : [{
							field : 'userId',
							title : '帳號',
							sortable : true,
							editable : true,
							align : 'center'
						}, {
							field : 'userName',
							title : '姓名',
							sortable : true,
							editable : true,
							align : 'center'
						}, {
							field : 'authority',
							title : '權限',
							sortable : true,
							editable : true,
							align : 'center'
						}, {
							field : 'operate',
							title : '刪除',
							align : 'center',
							events : operateEvents,
							formatter : operateFormatter,
						}],
						data : jsonData,
					});
				},
				beforeSend : function() {
					$('#loading').show();
				},
				complete : function() {
					$('#loading').hide();
				},
				error : function() {
					alert("ERROR!!!");
				}
			});

			function addUser(userId, userName, authority) {
				jsonData = $.ajax({
					url : serverIP + '/service/useradd',
					type : "POST",
					dataType : 'json',
					data : {
						userId : userId,
						userName : userName,
						authority : authority,
					},
					success : function(jsonData) {
						// Split timestamp and data into
						// separate arrays
						if (jsonData == null) {
							alert("新增失敗！請冾管理人員");
							return;
						} else {
							alert(jsonData);
						}
					},
					beforeSend : function() {
						$('#loading').show();
					},
					complete : function() {
						$('#loading').hide();
						tableRefresh();
					},
					error : function() {
						alert("連線有問題，請冾管理人員!!");
					}
				});
			}

			function tableRefresh() {
				$('#tb_report').bootstrapTable('refresh');
			};
		</script>
	</body>

</html>
